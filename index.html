<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Airbag & Radar Solutions - Catálogo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- PapaParse para leer CSV sin errores -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    *{box-sizing:border-box;margin:0;padding:0;font-family:Arial,Helvetica,sans-serif}
    body{background:#ededed;color:#333}
    header{background:#ffe600;color:#000;padding:20px;text-align:center}
    nav{display:flex;justify-content:center;gap:10px;background:#fff;box-shadow:0 2px 4px rgba(0,0,0,.1);padding:10px;flex-wrap:wrap}
    nav button{background:#fff;border:1px solid #ddd;padding:10px 20px;font-size:16px;cursor:pointer;border-radius:8px;transition:.3s}
    nav button:hover{background:#ffe600;border-color:#ffe600}
    section{display:none;padding:20px;max-width:1200px;margin:auto;background:#fff;min-height:70vh}
    section.active{display:block}
    h2{margin-bottom:15px;color:#333}
    .catalogo-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;padding:20px 0}
    .product-card{background:#fff;border:1px solid #e0e0e0;border-radius:12px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,.05);transition:.3s}
    .product-card:hover{box-shadow:0 4px 12px rgba(0,0,0,.1)}
    .card-img{width:100%;height:200px;object-fit:cover;background:#f5f5f5}
    .card-body{padding:15px}
    .card-title{font-size:16px;font-weight:600;color:#000;margin-bottom:6px;height:40px;overflow:hidden}
    .card-meta{font-size:14px;color:#666;margin-bottom:6px}
    .card-price{font-size:20px;font-weight:700;color:#00a650;margin-bottom:10px}
    .card-btn{background:#25D366;color:#fff;padding:10px 16px;border:none;border-radius:8px;font-size:14px;cursor:pointer;width:100%;transition:.3s}
    .card-btn:hover{background:#1ebe5a}
    footer{text-align:center;padding:20px;background:#fff}
  </style>
</head>
<body>

<header>
  <h1>🚗 Airbag & Radar Solutions</h1>
  <p>Catálogo y contacto</p>
</header>

<nav>
  <button onclick="mostrar('tienda')">Catálogo</button>
  <button onclick="mostrar('contacto')">Contacto</button>
</nav>

<!-- CATÁLOGO -->
<section id="tienda" class="active">
  <h2>Catálogo de productos</h2>
  <div id="catalogoCliente" class="catalogo-grid">Cargando catálogo...</div>
</section>

<!-- CONTACTO -->
<section id="contacto">
  <h2>Contacto</h2>
  <a href="https://wa.me/526611721599" target="_blank" style="background:#25D366;color:#fff;padding:12px 24px;border-radius:4px;text-decoration:none">📲 WhatsApp +52 661 172 1599</a>
</section>

<footer>Airbag & Radar Solutions © 2025</footer>

<script>
  /* ---------- ANTI-PARPADE0 + SAFE CSV ---------- */
  async function cargarProductos(){
    try{
      const url='https://raw.githubusercontent.com/xlaraislas-tech/airbag-radar-solutions/main/productos-ml-final-v10.csv';
      const res=await fetch(url); if(!res.ok) throw new Error('CSV no encontrado');
      const text=await res.text();
      Papa.parse(text,{header:true, skipEmptyLines:true, complete:function(result){
        const productos=result.data.map(p=>{
          function val(campo){return (p[campo]||'').toString().trim();}
          return{
            codigo_oem:        val('codigo_oem'),
            titulo:            val('titulo'),
            descripcion_larga: val('descripcion_larga'),
            caracteristicas:   val('caracteristicas'),
            categoria:         val('categoria'),
            subcategoria:      val('subcategoria'),
            marca:             val('marca'),
            modelo:            val('modelo'),
            anio:              val('anio'),
            precio:            parseFloat(p.precio)||0,
            stock:             parseInt(p.stock)||0,
            imagen_url:        val('imagen_url'),
            imagen_url_2:      val('imagen_url_2'),
            imagen_url_3:      val('imagen_url_3'),
            etiquetas:         val('etiquetas')
          };
        }).filter(p=>p.titulo);
        renderCatalogo(productos);
      }});
    }catch(err){
      console.error(err);
      document.getElementById('catalogoCliente').innerHTML='<p>Error al cargar catálogo. Recarga la página.</p>';
    }
  }

  function renderCatalogo(productos){
    const div=document.getElementById('catalogoCliente');
    if(!productos.length){div.innerHTML='<p>No hay productos cargados aún.</p>';return;}
    div.innerHTML='';   // solo una vez
    productos.forEach(p=>{
      const titulo = p.titulo.replace(/"/g,'&quot;');
      const marca  = p.marca.replace(/"/g,'&quot;');
      const modelo = p.modelo.replace(/"/g,'&quot;');
      const anio   = p.anio.replace(/"/g,'&quot;');
      const img    = (p.imagen_url||'').trim();
      const imgTag = `<img class="card-img" src="${img}" alt="${titulo}" onerror="if(this.src!=='https://i.imgur.com/placeholder.png')this.src='https://i.imgur.com/placeholder.png';">`;

      div.insertAdjacentHTML('beforeend',`
      <div class="product-card">
        ${imgTag}
        <div class="card-body">
          <div class="card-title">${titulo}</div>
          <div class="card-meta">${marca} ${modelo} ${anio}</div>
          <div class="card-price">$${p.precio} MXN</div>
          <button class="card-btn" onclick="wpProducto('${p.codigo_oem}','${titulo}',${p.precio},${p.stock})">Comprar por WhatsApp</button>
        </div>
      </div>`);
    });
  }

  function wpProducto(codigo,titulo,precio,stock){
    const texto=`Hola, vengo de Airbag & Radar Solutions y quiero comprar:\n\nCódigo: ${codigo}\nProducto: ${titulo}\nPrecio: $${precio} MXN\nStock: ${stock} unidades\n\n¿Cómo hago el depósito?`;
    window.open(`https://wa.me/526611721599?text=${encodeURIComponent(texto)}`,'_blank');
  }

  function mostrar(id){
    document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  window.onload=()=>{cargarProductos();};
</script>
</body>
</html>
